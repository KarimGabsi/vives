<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-docs-cloud-for-ai docs-doc-id-Chapter 3 - Docker Swarm & API/docker swarm">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Docker Swarm | Vives Courses</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://karimgabsi.github.io/vives/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker swarm"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs-cloud-for-ai-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs-cloud-for-ai-current"><meta data-rh="true" property="og:title" content="Docker Swarm | Vives Courses"><meta data-rh="true" name="description" content="Source: Official Documentation"><meta data-rh="true" property="og:description" content="Source: Official Documentation"><link data-rh="true" rel="icon" href="/vives/img/favicons.ico"><link data-rh="true" rel="canonical" href="https://karimgabsi.github.io/vives/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker swarm"><link data-rh="true" rel="alternate" href="https://karimgabsi.github.io/vives/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker swarm" hreflang="en"><link data-rh="true" rel="alternate" href="https://karimgabsi.github.io/vives/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker swarm" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/vives/blog/rss.xml" title="Vives Courses RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/vives/blog/atom.xml" title="Vives Courses Atom Feed">








<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/vives/assets/css/styles.5a7e4266.css">
<link rel="preload" href="/vives/assets/js/runtime~main.6f4451e6.js" as="script">
<link rel="preload" href="/vives/assets/js/main.a3570394.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/vives/"><div class="navbar__logo"><img src="/vives/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/vives/img/logo_white.jpg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/vives/docs-intro-to-ai/Intro">Introduction to AI</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/vives/docs-cloud-for-ai/Intro">Cloud for AI</a><a class="navbar__item navbar__link" href="/vives/docs-power-bi/Intro">Power BI</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vives/docs-cloud-for-ai/intro">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/vives/docs-cloud-for-ai/Chapter 1 - Docker Basics/concept">Chapter 1 - Docker Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/vives/docs-cloud-for-ai/Chapter 2 - Docker Hub &amp; Compose/docker hub">Chapter 2 - Docker Hub &amp; Compose</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker swarm">Chapter 3 - Docker Swarm &amp; API</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker swarm">Docker Swarm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker SDK for python">Docker SDK for Python</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/vives/docs-cloud-for-ai/Chapter 4 - Epsagon/setup">Chapter 4 - Epsagon</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/vives/docs-cloud-for-ai/Chapter 5 - Summary Excercise/xor">Chapter 5 - Summary Excercise</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/vives/docs-cloud-for-ai/Chapter 6 - Scrapy/official tutorial">Chapter 6 - Scrapy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/vives/docs-cloud-for-ai/Chapter 7 - Final Assignment/final assignment">Chapter 7 - Final Assignment</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/vives/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Chapter 3 - Docker Swarm &amp; API</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Docker Swarm</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Docker Swarm</h1><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Source: <a href="https://docs.docker.com/engine/swarm/key-concepts/" target="_blank" rel="noopener noreferrer">Official Documentation</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-swarm">What is a swarm?<a class="hash-link" href="#what-is-a-swarm" title="Direct link to heading">​</a></h2><p>The cluster management and orchestration features embedded in the Docker Engine are built using swarmkit.
Swarmkit is a separate project which implements Docker’s orchestration layer and is used directly within Docker.</p><p>A swarm consists of multiple Docker hosts which run in swarm mode and act as managers (to manage membership and delegation) and workers (which run swarm services).
A given Docker host can be a manager, a worker, or perform both roles.
When you create a service, you define its optimal state (number of replicas, network and storage resources available to it,
ports the service exposes to the outside world, and more).
Docker works to maintain that desired state.
For instance, if a worker node becomes unavailable, Docker schedules that node’s tasks on other nodes.
A task is a running container which is part of a swarm service and managed by a swarm manager, as opposed to a standalone container.</p><p>One of the key advantages of swarm services over standalone containers is that you can modify a service’s configuration,
including the networks and volumes it is connected to, without the need to manually restart the service.
Docker will update the configuration, stop the service tasks with the out of date configuration, and create new ones matching the desired configuration.</p><p>When Docker is running in swarm mode, you can still run standalone containers on any of the Docker hosts participating in the swarm, as well as swarm services.
A key difference between standalone containers and swarm services is that only swarm managers can manage a swarm,
while standalone containers can be started on any daemon. Docker daemons can participate in a swarm as managers, workers, or both.</p><p>In the same way that you can use Docker Compose to define and run containers, you can define and run Swarm service stacks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nodes">Nodes<a class="hash-link" href="#nodes" title="Direct link to heading">​</a></h2><p>A node is an instance of the Docker engine participating in the swarm.
You can also think of this as a Docker node.
You can run one or more nodes on a single physical computer or cloud server,
but production swarm deployments typically include Docker nodes distributed across multiple physical and cloud machines.</p><p>To deploy your application to a swarm, you submit a service definition to a manager node.
The manager node dispatches units of work called tasks to worker nodes.</p><p>Manager nodes also perform the orchestration and cluster management functions required to maintain the desired state of the swarm.
Manager nodes elect a single leader to conduct orchestration tasks.</p><p>Worker nodes receive and execute tasks dispatched from manager nodes.
By default, manager nodes also run services as worker nodes, but you can configure them to run manager tasks exclusively and be manager-only nodes.
An agent runs on each worker node and reports on the tasks assigned to it. The worker node notifies the manager node of the current state of its assigned tasks so that the manager can maintain the desired state of each worker.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="services-and-tasks">Services and tasks<a class="hash-link" href="#services-and-tasks" title="Direct link to heading">​</a></h2><p>A service is the definition of the tasks to execute on the manager or worker nodes.
It is the central structure of the swarm system and the primary root of user interaction with the swarm.</p><p>When you create a service, you specify which container image to use and which commands to execute inside running containers.
In the replicated services model, the swarm manager distributes a specific number of replica tasks among the nodes based upon the scale you set in the desired state.</p><p>For global services, the swarm runs one task for the service on every available node in the cluster.
A task carries a Docker container and the commands to run inside the container.
It is the atomic scheduling unit of swarm. Manager nodes assign tasks to worker nodes according to the number of replicas set in the service scale.
Once a task is assigned to a node, it cannot move to another node. It can only run on the assigned node or fail.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="load-balancing">Load balancing<a class="hash-link" href="#load-balancing" title="Direct link to heading">​</a></h2><p>The swarm manager uses ingress load balancing to expose the services you want to make available externally to the swarm.
The swarm manager can automatically assign the service a PublishedPort or you can configure a PublishedPort for the service.
You can specify any unused port. If you do not specify a port, the swarm manager assigns the service a port in the 30000-32767 range.</p><p>External components, such as cloud load balancers, can access the service on the PublishedPort of any node in the cluster whether or not the node is currently running the task for the service.
All nodes in the swarm route ingress connections to a running task instance.</p><p>Swarm mode has an internal DNS component that automatically assigns each service in the swarm a DNS entry.
The swarm manager uses internal load balancing to distribute requests among services within the cluster based upon the DNS name of the service.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="excercise">Excercise<a class="hash-link" href="#excercise" title="Direct link to heading">​</a></h2><ol><li>Create a file called <strong>docker-stack.yml</strong></li></ol><p>This file will dictate a swarm that consists of:</p><ul><li>3 types containers:<ul><li>a service called viewcounter which has two replicas</li><li>a service for a database (we do not currently use this though)</li><li>a service called worker which can only have one replica</li></ul></li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Pay attention to the ports, volume, <strong>roles</strong> and <strong>networks</strong>!</p></div></div><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">docker-stack.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">version: &quot;3.7&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  viewcounter:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: revelare/autobuildtest:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - 5001:5000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - 5002:5000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - TestVolume:/app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    networks:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - frontend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deploy:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      replicas: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      update_config:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        parallelism: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      restart_policy:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        condition: on-failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  db:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: postgres:9.4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      POSTGRES_USER: &quot;postgres&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      POSTGRES_PASSWORD: &quot;postgres&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - db-data:/var/lib/postgresql/data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    networks:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - backend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deploy:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      placement:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        constraints: [node.role == manager]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  worker:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: revelare/autobuildtest:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - mode: host</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        target: 5000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        published: 5555</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    networks:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - backend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - TestVolume:/app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deploy:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      mode: replicated</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      replicas: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      labels: [EXTRA WORKER]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      restart_policy:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        condition: on-failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        delay: 10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        max_attempts: 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        window: 120s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      placement:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        constraints: [node.role == manager]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">networks:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  frontend:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  backend:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  TestVolume:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    external: false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  db-data:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    external: false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-a-swarm-cli">Deploying a swarm (CLI)<a class="hash-link" href="#deploying-a-swarm-cli" title="Direct link to heading">​</a></h2><p>These are the important commands:</p><ol><li>Open the Terminal and go to your project</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd Docker API</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Activate the swarm engine:</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker swarm init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>Once a swarm has been initizialed you&#x27;ll become the manager. <br>
If other computers want to join your swarm they will need the info the terminal has provided you: <br><br>
Example: <br>
docker swarm join --token SWMTKN-1-1ehzbqxp4nxgifv0bzlzhy2lh4moclr66iobpfenqa409hnjvl-botgz2yulqtrok44hu4wy86an 192.168.65.3:2377</p></div></div><ol start="2"><li>Leaving a swarm can be done by the following command:</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker swarm leave</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>or if you already in a previous one:</p></blockquote><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker swarm leave --force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Deploy your swarm compose file:</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker stack deploy --compose-file docker-stack.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>To start your swarm project:</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker stack services swarmexcercise</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>To show your services:</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker service ls</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>To remove your swarm project:</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker stack rm swarmexcercise</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/vives/docs-cloud-for-ai/Chapter 2 - Docker Hub &amp; Compose/docker compose"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Docker Compose</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/vives/docs-cloud-for-ai/Chapter 3 - Docker Swarm &amp; API/docker SDK for python"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker SDK for Python</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-a-swarm" class="table-of-contents__link toc-highlight">What is a swarm?</a></li><li><a href="#nodes" class="table-of-contents__link toc-highlight">Nodes</a></li><li><a href="#services-and-tasks" class="table-of-contents__link toc-highlight">Services and tasks</a></li><li><a href="#load-balancing" class="table-of-contents__link toc-highlight">Load balancing</a></li><li><a href="#excercise" class="table-of-contents__link toc-highlight">Excercise</a></li><li><a href="#deploying-a-swarm-cli" class="table-of-contents__link toc-highlight">Deploying a swarm (CLI)</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Karim Gabsi</div></div></div></footer></div>
<script src="/vives/assets/js/runtime~main.6f4451e6.js"></script>
<script src="/vives/assets/js/main.a3570394.js"></script>
</body>
</html>